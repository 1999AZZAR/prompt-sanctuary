{% extends "base.html" %}

{% block content %}
<div class="hero text-center mb-12 cursor-pointer" onclick="toggleSidePanel()">
  <h1 class="text-5xl font-bold text-white" id="page-heading"><i class="fas fa-user mr-2"></i>Profile</h1>
  <p class="text-lg text-gray-300">Manage your account and prompts.</p>
</div>
<div class="mdc-layout-grid" role="region" aria-labelledby="page-heading">
  <div class="mdc-layout-grid__inner">
    <!-- Settings Card -->
    <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 mdc-layout-grid__cell--span-4-desktop mb-6" role="region" aria-labelledby="settings-heading">
      <div class="mdc-card glass prompt-card">
        <div class="mdc-card__primary-action p-6" tabindex="0">
          <h2 id="settings-heading" class="text-2xl font-semibold text-white mb-4 flex items-center space-x-2">
            <i class="fas fa-cog fa-lg text-blue-400"></i>
            <span>Settings</span>
          </h2>
          {% if error %}<div class="text-red-400 mb-4" role="alert">{{ error }}</div>{% endif %}
          {% if success %}<div class="text-green-400 mb-4" role="status">{{ success }}</div>{% endif %}
          <form action="{{ url_for('main.profile') }}" method="post" class="space-y-4" role="form" aria-labelledby="update-password-heading">
            <h3 id="update-password-heading" class="sr-only">Update Password Form</h3>
            <div><label for="old_password" class="block text-gray-300">Old Password</label><input type="password" id="old_password" name="old_password" class="w-full p-3 bg-gray-700 rounded focus:outline-none text-white" required></div>
            <div><label for="new_password" class="block text-gray-300">New Password</label><input type="password" id="new_password" name="new_password" class="w-full p-3 bg-gray-700 rounded focus:outline-none text-white" required></div>
            <div><label for="confirm_password" class="block text-gray-300">Confirm Password</label><input type="password" id="confirm_password" name="confirm_password" class="w-full p-3 bg-gray-700 rounded focus:outline-none text-white" required></div>
            <button class="mdc-button mdc-button--raised fullwidth" type="submit"><span class="mdc-button__label">Update Password</span></button>
          </form>
          <form action="{{ url_for('main.delete_account') }}" method="post" onsubmit="return confirm('Are you sure? This cannot be undone.');" class="mt-4" role="form" aria-labelledby="delete-account-heading">
            <h3 id="delete-account-heading" class="sr-only">Delete Account Form</h3>
            <button class="mdc-button mdc-button--outlined text-red-400 fullwidth" type="submit"><span class="mdc-button__label">Delete Account</span></button>
          </form>
        </div>
      </div>
    </div>
    <!-- Saved Prompts Card -->
    <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 mdc-layout-grid__cell--span-4-desktop mb-6" role="region" aria-labelledby="saved-prompts-heading">
      <div class="mdc-card glass prompt-card">
        <div class="mdc-card__primary-action p-6" tabindex="0">
          <h2 id="saved-prompts-heading" class="text-2xl font-semibold text-white mb-4 flex items-center space-x-2">
            <i class="fas fa-bookmark fa-lg text-green-400"></i>
            <span>Saved Prompts</span>
          </h2>
          {% if saved_prompts %}
          <ul class="divide-y divide-gray-700 space-y-2" role="list">
            {% for pr in saved_prompts %}
            <li class="flex justify-between items-center py-2" role="listitem">
              <div><p class="text-white">{{ pr['title'] }}</p><p class="text-gray-400 text-sm">{{ pr['time'] }}</p></div>
              <div class="space-x-2">
                <button class="mdc-button mdc-button--text see-button" data-title="{{ pr['title']|e }}" data-content="{{ pr['prompt']|e }}" aria-label="View {{ pr['title'] }}">View</button>
                <button class="mdc-button mdc-button--text text-red-400 delete-button" data-prompt-id="{{ pr['prompt_id'] }}" aria-label="Delete {{ pr['title'] }}">Delete</button>
              </div>
            </li>
            {% endfor %}
          </ul>
          {% else %}<p class="text-gray-400">No saved prompts yet.</p>{% endif %}
        </div>
      </div>
    </div>
    <!-- Shared Prompts Card -->
    <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 mdc-layout-grid__cell--span-4-desktop mb-6" role="region" aria-labelledby="shared-prompts-heading">
      <div class="mdc-card glass prompt-card">
        <div class="mdc-card__primary-action p-6" tabindex="0">
          <h2 id="shared-prompts-heading" class="text-2xl font-semibold text-white mb-4 flex items-center space-x-2">
            <i class="fas fa-share-alt fa-lg text-yellow-400"></i>
            <span>Shared Prompts</span>
          </h2>
          {% if shared_prompts %}
          <ul class="divide-y divide-gray-700 space-y-2" role="list">
            {% for pr in shared_prompts %}
            <li class="flex justify-between items-center py-2" role="listitem">
              <div><p class="text-white">{{ pr['title'] }}</p><p class="text-gray-400 text-sm">{{ pr['time'] }}</p></div>
              <div class="space-x-2">
                <button class="mdc-button mdc-button--text see-button" data-title="{{ pr['title']|e }}" data-content="{{ pr['prompt']|e }}" aria-label="View {{ pr['title'] }}">View</button>
                <button class="mdc-button mdc-button--text text-red-400 unshare-button" data-prompt-id="{{ pr['prompt_id'] }}" aria-label="Unshare {{ pr['title'] }}">Unshare</button>
              </div>
            </li>
            {% endfor %}
          </ul>
          {% else %}<p class="text-gray-400">No shared prompts yet.</p>{% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
<script defer src="{{ url_for('static', filename='script/personal.js') }}"></script>
<script defer src="{{ url_for('static', filename='script/community.js') }}"></script>
{% endblock %}
